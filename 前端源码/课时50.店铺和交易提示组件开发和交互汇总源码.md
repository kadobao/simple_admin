## 文件夹结构
```
├── .gitignore
├── .vscode/
├── README.md
├── index.html
├── node_modules/
├── package-lock.json
├── package.json
├── public/
├── src/
│   ├── App.vue
│   ├── api/
│   │   ├── index.js
│   │   ├── manager.js
│   │   └── user.js
│   ├── assets/
│   │   └── logo.png
│   ├── axios.js
│   ├── components/
│   │   ├── CountTo.vue
│   │   ├── FormDrawer.vue
│   │   ├── IndexCard.vue
│   │   ├── IndexChart.vue
│   │   └── IndexNavs.vue
│   ├── composables/
│   │   ├── auth.js
│   │   ├── useManager.js
│   │   ├── useTabList.js
│   │   └── util.js
│   ├── layouts/
│   │   ├── admin.vue
│   │   └── components/
│   │       ├── FHeader.vue
│   │       ├── FMenu.vue
│   │       └── FTagList.vue
│   ├── main.js
│   ├── pages/
│   │   ├── 404.vue
│   │   ├── category/
│   │   │   └── list.vue
│   │   ├── comment/
│   │   │   └── list.vue
│   │   ├── coupon/
│   │   │   └── list.vue
│   │   ├── goods/
│   │   │   └── list.vue
│   │   ├── image/
│   │   │   └── list.vue
│   │   ├── index.vue
│   │   ├── login.vue
│   │   ├── notice/
│   │   │   └── list.vue
│   │   ├── order/
│   │   │   └── list.vue
│   │   ├── setting/
│   │   │   └── base.vue
│   │   └── user/
│   │       └── list.vue
│   ├── permission.js
│   ├── router/
│   │   └── index.js
│   └── store/
│       └── index.js
├── vite.config.js
└── 课时50.店铺和交易提示组件开发和交互汇总源码.md
```

====================== 课时50.店铺和交易提示组件开发和交互\.gitignore ======================
## 课时50.店铺和交易提示组件开发和交互\.gitignore
```  # 内容未读取（排除）
```

====================== 课时50.店铺和交易提示组件开发和交互\index.html ======================
## 课时50.店铺和交易提示组件开发和交互\index.html
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>

```

====================== 课时50.店铺和交易提示组件开发和交互\package-lock.json ======================
## 课时50.店铺和交易提示组件开发和交互\package-lock.json
```  # 内容未读取（排除）
```

====================== 课时50.店铺和交易提示组件开发和交互\package.json ======================
## 课时50.店铺和交易提示组件开发和交互\package.json
```json
{
  "name": "shop-admin",
  "private": true,
  "version": "0.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@element-plus/icons-vue": "^1.1.4",
    "@vueuse/core": "^8.4.2",
    "@vueuse/integrations": "^8.4.1",
    "axios": "^0.27.2",
    "echarts": "^5.3.2",
    "element-plus": "^2.1.11",
    "gsap": "^3.10.4",
    "nprogress": "^0.2.0",
    "pinia": "^2.2.4",
    "universal-cookie": "^4.0.4",
    "vue": "^3.2.25",
    "vue-router": "^4.0.15"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^2.3.1",
    "mockjs": "^1.1.0",
    "vite": "^2.9.7",
    "vite-plugin-windicss": "^1.8.4",
    "windicss": "^3.5.1"
  }
}

```

====================== 课时50.店铺和交易提示组件开发和交互\README.md ======================
## 课时50.店铺和交易提示组件开发和交互\README.md
```md
# Vue 3 + Vite

This template should help get you started developing with Vue 3 in Vite. The template uses Vue 3 `<script setup>` SFCs, check out the [script setup docs](https://v3.vuejs.org/api/sfc-script-setup.html#sfc-script-setup) to learn more.

## Recommended IDE Setup

- [VS Code](https://code.visualstudio.com/) + [Volar](https://marketplace.visualstudio.com/items?itemName=Vue.volar)

```

====================== 课时50.店铺和交易提示组件开发和交互\vite.config.js ======================
## 课时50.店铺和交易提示组件开发和交互\vite.config.js
```js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import WindiCSS from 'vite-plugin-windicss'

import path from "path"

// https://vitejs.dev/config/
export default defineConfig({
  resolve: {
    alias: {
      "~": path.resolve(__dirname, "src")
    }
  },

  server: {
    port: 3002, // 设置为 3002
  },

  // server: {
  //   proxy: {
  //     '/api': {
  //       target: 'http://ceshi13.dishait.cn',
  //       changeOrigin: true,
  //       rewrite: (path) => path.replace(/^\/api/, '')
  //     },
  //   }
  // },

  define: {
    '__VUE_OPTIONS_API__': true,
    '__VUE_PROD_DEVTOOLS__': false,
    '__VUE_PROD_HYDRATION_MISMATCH_DETAILS__': false,
  },

  plugins: [vue(), WindiCSS()]
})

```

====================== 课时50.店铺和交易提示组件开发和交互\课时50.店铺和交易提示组件开发和交互汇总源码.md ======================
## 课时50.店铺和交易提示组件开发和交互\课时50.店铺和交易提示组件开发和交互汇总源码.md
```  # 内容未读取（排除）
```

====================== 课时50.店铺和交易提示组件开发和交互\src\App.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\App.vue
```vue
<script setup>

</script>

<template>
  <router-view></router-view>
</template>

<style>
body{
  @apply bg-gray-100;
}
#nprogress .bar{
  background-color: #f4f4f4!important;
  height: 3px!important;
}
</style>

```

====================== 课时50.店铺和交易提示组件开发和交互\src\axios.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\axios.js
```js
import axios from "axios"
import { toast } from '~/composables/util'
import { getToken } from '~/composables/auth'
import { useUserStore } from '~/store' // 导入 Pinia store

const service = axios.create({
    baseURL: 'http://localhost:3000/api', // 指向后端服务器
    timeout: 8000,
  });

// 添加请求拦截器
service.interceptors.request.use(function (config) {
    // 往header头自动添加token
    const token = getToken()
    if (token) {
        config.headers["token"] = token
    }

    return config;
}, function (error) {
    // 对请求错误做些什么
    return Promise.reject(error);
});

// 添加响应拦截器
service.interceptors.response.use(function (response) {
    // 对响应数据做点什么
    return response.data.data;
}, function (error) {
    const msg = error.response.data.msg || "请求失败"

    if (msg == "非法token，请先登录！") {
        const userStore = useUserStore() // 使用 Pinia store
        userStore.logoutUser().finally(() => location.reload())
    }

    toast(msg, "error")

    return Promise.reject(error);
})

export default service
```

====================== 课时50.店铺和交易提示组件开发和交互\src\main.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\main.js
```js
import { createApp } from 'vue'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import App from './App.vue'
import { router } from './router'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
import { createPinia } from 'pinia'
// import './mock' // 同步引入

import 'virtual:windi.css'
import 'nprogress/nprogress.css'



const app = createApp(App)

const pinia = createPinia()
app.use(pinia)

app.use(router)
app.use(ElementPlus)

// 全局注册 Element Plus 图标组件
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)
}

// 确保在初始化 Pinia 和其他插件之后再导入权限控制
import "./permission"

app.mount('#app')

```

====================== 课时50.店铺和交易提示组件开发和交互\src\permission.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\permission.js
```js
import { router, addRoutes } from "~/router"
import { getToken } from "~/composables/auth"
import { 
    toast,
    showFullLoading,
    hideFullLoading
} from "~/composables/util"
import { useUserStore } from '~/store'

let hasGetInfo = false

router.beforeEach(async (to, from, next) => {
    showFullLoading()

    const token = getToken()

    if (!token && to.path !== "/login") {
        toast("请先登录", "error")
        return next({ path: "/login" })
    }

    if (token && to.path === "/login") {
        toast("请勿重复登录", "error")
        return next({ path: from.path ? from.path : "/" })
    }

    const userStore = useUserStore()

    let hasNewRoutes = false
    if (token && !hasGetInfo) {
        let { menus } = await userStore.fetchUserInfo()
        hasGetInfo = true
        hasNewRoutes = addRoutes(menus)
    }

    let title = (to.meta.title ? to.meta.title : "")
    document.title = title

    hasNewRoutes ? next(to.fullPath) : next()
})

router.afterEach((to, from) => hideFullLoading())

```

====================== 课时50.店铺和交易提示组件开发和交互\src\api\index.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\api\index.js
```js
import axios from '~/axios'

export function getStatistics1(){
    return axios.get("/admin/statistics1")
}

export function getStatistics2(){
    return axios.get("/admin/statistics2")
}

export function getStatistics3(type){
    return axios.get("/admin/statistics3?type="+type)
}
```

====================== 课时50.店铺和交易提示组件开发和交互\src\api\manager.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\api\manager.js
```js
import axios from '~/axios'

export function login(username,password){
    return axios.post("/admin/login",{
        username,
        password
    })
}

export function getinfo(){
    return axios.post("/admin/getinfo")
}

export function logout(){
    return axios.post("/admin/logout")
}

export function updatepassword(data){
    return axios.post("/admin/updatepassword",data)
}
```

====================== 课时50.店铺和交易提示组件开发和交互\src\api\user.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\api\user.js
```js
// src/api/user.js

import axios from '~/axios';

export function uploadAvatar(data) {
  return axios.post('/admin/upload', data, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
}

export function updateUserInfo(data) {
  return axios.post('/admin/updateuserinfo', data);
}

```

====================== 课时50.店铺和交易提示组件开发和交互\src\assets\logo.png ======================
## 课时50.店铺和交易提示组件开发和交互\src\assets\logo.png
```  # 内容未读取（排除）
```

====================== 课时50.店铺和交易提示组件开发和交互\src\components\CountTo.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\components\CountTo.vue
```vue
<template>
    {{ d.num.toFixed(0) }}
</template>
<script setup>
import { reactive,watch } from "vue"
import gsap from "gsap"

const props = defineProps({
    value:{
        type:Number,
        default:0
    }
})

const d = reactive({
    num:0
})

function AnimateToValue(){
    gsap.to(d,{
        duration:0.5,
        num:props.value
    })
}

AnimateToValue()

watch(()=>props.value,()=>AnimateToValue())

</script>

```

====================== 课时50.店铺和交易提示组件开发和交互\src\components\FormDrawer.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\components\FormDrawer.vue
```vue
<template>
    <el-drawer v-model="showDrawer" 
    :title="title" 
    :size="size" 
    :close-on-click-modal="false"
    :destroy-on-close="destroyOnClose">
        <div class="formDrawer">
            <div class="body">
                <slot></slot>
            </div>
            <div class="actions">
                <el-button type="primary" @click="submit" :loading="loading">{{ confirmText }}</el-button>
                <el-button type="default" @click="close">取消</el-button>
            </div>
        </div>
    </el-drawer>
</template>
<script setup>
    import { ref } from "vue"

    const showDrawer = ref(false)

    const props = defineProps({
        title:String,
        size:{
            type:String,
            default:"45%"
        },
        destroyOnClose:{
            type:Boolean,
            default:false
        },
        confirmText:{
            type:String,
            default:"提交"
        }
    })

    const loading = ref(false)
    const showLoading = ()=>loading.value = true
    const hideLoading = ()=>loading.value = false

    // 打开
    const open = ()=> showDrawer.value = true

    // 关闭
    const close = ()=>showDrawer.value = false

    // 提交
    const emit = defineEmits(["submit"])
    const submit = ()=> emit("submit")

    // 向父组件暴露以下方法
    defineExpose({
        open,
        close,
        showLoading,
        hideLoading
    })

</script>
<style>
    .formDrawer{
        width: 100%;
        height: 100%;
        position: relative;
        @apply flex flex-col;
    }

    .formDrawer .body{
        flex: 1;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 50px;
        overflow-y: auto;
    }

    .formDrawer .actions{
        height: 50px;
        @apply mt-auto flex items-center;
    }
</style>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\components\IndexCard.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\components\IndexCard.vue
```vue
<template>
    <el-card shadow="never">
        <template #header>
            <div class="flex justify-between">
                <span class="text-sm">{{ title }}</span>
                <el-tag type="danger" effect="plain">
                    {{ tip }}
                </el-tag>
            </div>
        </template>
        <el-row :gutter="20">
            <el-col :span="6" :offset="0" v-for="(item,index) in btns" :key="index">
                <el-card shadow="hover" class="border-0 bg-light-400">
                    <div class="flex flex-col items-center justify-center">
                        <span class="text-xl mb-2">{{ item.value }}</span>
                        <span class="text-xs text-gray-500">{{ item.label }}</span>
                    </div>
                </el-card>
            </el-col>
        </el-row>
        
    </el-card>
    
</template>
<script setup>
defineProps({
    title:String,
    tip:String,
    btns:Array
})
</script>

```

====================== 课时50.店铺和交易提示组件开发和交互\src\components\IndexChart.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\components\IndexChart.vue
```vue
<template>
    <el-card shadow="never">
        <template #header>
            <div class="flex justify-between">
                <span class="text-sm">订单统计</span>
                <div>
                    <el-check-tag v-for="(item, index) in options" :key="index" :checked="current == item.value"
                        style="margin-right: 8px" @click="handleChoose(item.value)">{{ item.text }}</el-check-tag>
                </div>
            </div>
        </template>
        <div ref="el" id="chart" style="width: 100%;height: 300px;"></div>
    </el-card>
</template>
<script setup>
import { ref, onMounted,onBeforeUnmount } from 'vue';
import * as echarts from 'echarts';
import { useResizeObserver } from '@vueuse/core'

import {
    getStatistics3
} from "~/api/index.js"

const current = ref("week")
const options = [{
    text: "近1个月",
    value: "month"
}, {
    text: "近1周",
    value: "week"
}, {
    text: "近24小时",
    value: "hour"
}]

const handleChoose = (type) => {
    current.value = type
    getData()
}

var myChart = null
onMounted(() => {
    var chartDom = document.getElementById('chart');
    myChart = echarts.init(chartDom);

    getData()
})

onBeforeUnmount(()=>{
    if(myChart) echarts.dispose(myChart)
})

function getData() {
    let option = {
        xAxis: {
            type: 'category',
            data: []
        },
        yAxis: {
            type: 'value'
        },
        series: [
            {
                data: [],
                type: 'bar',
                showBackground: true,
                backgroundStyle: {
                    color: 'rgba(180, 180, 180, 0.2)'
                }
            }
        ]
    };

    myChart.showLoading()
    getStatistics3(current.value).then(res=>{
        option.xAxis.data = res.x
        option.series[0].data = res.y

        myChart.setOption(option)
    }).finally(()=>{
        myChart.hideLoading()
    })



}


const el = ref(null)
useResizeObserver(el, (entries) => myChart.resize())

</script>

```

====================== 课时50.店铺和交易提示组件开发和交互\src\components\IndexNavs.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\components\IndexNavs.vue
```vue
<template>
    <el-row :gutter="20" class="mt-5">
        <el-col :span="3" :offset="0" v-for="(item,index) in iconNavs" :key="index">
            <el-card shadow="hover" @click="goTo(item.path)">
                <div class="flex flex-col items-center justify-center cursor-pointer">
                    <el-icon :size="16" :class="item.color">
                        <component :is="item.icon"/>
                    </el-icon>
                    <span class="text-sm mt-2">{{ item.title }}</span>
                </div>
            </el-card>
        </el-col>
    </el-row>
</template>

<script setup>
import { useRouter } from 'vue-router'

const router = useRouter()

const iconNavs = [
    {
        icon: "user",
        color: "text-light-blue-500",
        title: "用户",
        path: "/user/list"
    },
    {
        icon: "shopping-cart",
        color: "text-violet-500",
        title: "商品",
        path: "/goods/list"
    },
    {
        icon: "tickets",
        color: "text-fuchsia-500",
        title: "订单",
        path: "/order/list"
    },
    {
        icon: "chat-dot-square",
        color: "text-teal-500",
        title: "评价",
        path: "/comment/list"
    },
    {
        icon: "picture",
        color: "text-rose-500",
        title: "图库",
        path: "/image/list"
    },
    {
        icon: "bell",
        color: "text-green-500",
        title: "公告",
        path: "/notice/list"
    },
    {
        icon: "set-up",
        color: "text-grey-500",
        title: "配置",
        path: "/setting/base"
    },
    {
        icon: "files",
        color: "text-yellow-500",
        title: "优惠券",
        path: "/coupon/list"
    }
]

const goTo = (path) => {
    router.push(path)
}
</script>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\composables\auth.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\composables\auth.js
```js
import { useCookies } from '@vueuse/integrations/useCookies'
const TokenKey = "admin-token"
const cookie = useCookies()

// 获取token
export function getToken(){
    return cookie.get(TokenKey)
}

// 设置token
export function setToken(token){
    return cookie.set(TokenKey,token)
}

// 清除token
export function removeToken(){
    return cookie.remove(TokenKey)
}
```

====================== 课时50.店铺和交易提示组件开发和交互\src\composables\useManager.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\composables\useManager.js
```js
import { ref, reactive } from 'vue'
import { logout, updatepassword } from "~/api/manager"
import { showModal, toast } from "~/composables/util"
import { useRouter } from "vue-router"
import { useUserStore } from '~/store' // 导入 Pinia store

export function useRepassword() {
    const router = useRouter()
    const userStore = useUserStore() // 使用 Pinia store

    // 修改密码
    const formDrawerRef = ref(null)
    const form = reactive({
        oldpassword: "",
        password: "",
        repassword: ""
    })

    const rules = {
        oldpassword: [
            {
                required: true,
                message: '旧密码不能为空',
                trigger: 'blur'
            },
        ],
        password: [
            {
                required: true,
                message: '新密码不能为空',
                trigger: 'blur'
            },
        ],
        repassword: [
            {
                required: true,
                message: '确认密码不能为空',
                trigger: 'blur'
            },
        ]
    }

    const formRef = ref(null)
    const onSubmit = () => {
        formRef.value.validate((valid) => {
            if (!valid) {
                return false
            }
            formDrawerRef.value.showLoading()
            updatepassword(form)
                .then(res => {
                    toast("修改密码成功，请重新登录")
                    userStore.logoutUser() // 使用 Pinia store 的 action
                    // 跳转回登录页
                    router.push("/login")
                })
                .finally(() => {
                    formDrawerRef.value.hideLoading()
                })

        })
    }

    const openRePasswordForm = () => formDrawerRef.value.open()

    return {
        formDrawerRef,
        form,
        rules,
        formRef,
        onSubmit,
        openRePasswordForm
    }
}

export function useLogout() {
    const router = useRouter()
    const userStore = useUserStore() // 使用 Pinia store

    function handleLogout() {
        showModal("是否要退出登录？").then(res => {
            logout().finally(() => {
                userStore.logoutUser() // 使用 Pinia store 的 action
                // 跳转回登录页
                router.push("/login")
                // 提示退出登录成功
                toast("退出登录成功")
            })
        })
    }

    return {
        handleLogout
    }
}
```

====================== 课时50.店铺和交易提示组件开发和交互\src\composables\useTabList.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\composables\useTabList.js
```js
import { ref } from 'vue'
import { useRoute, onBeforeRouteUpdate } from 'vue-router';
import { useCookies } from '@vueuse/integrations/useCookies'
import { router } from '~/router';

export function useTabList() {
    const route = useRoute()
    const cookie = useCookies()

    const activeTab = ref(route.path)
    const tabList = ref([
        {
            title: '后台首页',
            path: "/"
        },
    ])

    // 添加标签导航
    function addTab(tab) {
        let noTab = tabList.value.findIndex(t => t.path == tab.path) == -1
        if (noTab) {
            tabList.value.push(tab)
        }

        cookie.set("tabList", tabList.value)
    }

    // 初始化标签导航列表
    function initTabList() {
        let tbs = cookie.get("tabList")
        if (tbs) {
            tabList.value = tbs
        }
    }

    initTabList()

    onBeforeRouteUpdate((to, from) => {
        activeTab.value = to.path
        addTab({
            title: to.meta.title,
            path: to.path
        })
    })

    const changeTab = (t) => {
        console.log(route.path);
        activeTab.value = t
        router.push(t)
    }

    const removeTab = (t) => {
        let tabs = tabList.value
        let a = activeTab.value
        if (a == t) {
            tabs.forEach((tab, index) => {
                if (tab.path == t) {
                    const nextTab = tabs[index + 1] || tabs[index - 1]
                    if (nextTab) {
                        a = nextTab.path
                    }
                }
            })
        }

        activeTab.value = a
        tabList.value = tabList.value.filter(tab => tab.path != t)

        cookie.set("tabList", tabList.value)
    }

    const handleClose = (c) => {
        if (c == "clearAll") {
            // 切换回首页
            activeTab.value = "/"
            // 过滤只剩下首页
            tabList.value = [{
                title: '后台首页',
                path: "/"
            }]
        } else if (c == "clearOther") {
            // 过滤只剩下首页和当前激活
            tabList.value = tabList.value.filter(tab => tab.path == "/" || tab.path == activeTab.value)
        }
        cookie.set("tabList", tabList.value)
    }

    return {
        activeTab,
        tabList,
        changeTab,
        removeTab,
        handleClose
    }
}
```

====================== 课时50.店铺和交易提示组件开发和交互\src\composables\util.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\composables\util.js
```js
import { ElNotification,ElMessageBox } from 'element-plus'
import nprogress from 'nprogress'
// 消息提示
export function toast(message,type = "success",dangerouslyUseHTMLString = false){
    ElNotification({
        message,
        type,
        dangerouslyUseHTMLString,
        duration:3000
    })
}

// 显示全屏loading
export function showFullLoading(){
  nprogress.start()
}

// 隐藏全屏loading
export function hideFullLoading(){
  nprogress.done()
}

export function showModal(content = "提示内容",type = "warning",title = ""){
    return ElMessageBox.confirm(
        content,
        title,
        {
          confirmButtonText: '确认',
          cancelButtonText: '取消',
          type,
        }
      )
}

```

====================== 课时50.店铺和交易提示组件开发和交互\src\layouts\admin.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\layouts\admin.vue
```vue
<template>
    <el-container>
        <el-header>
            <f-header/>
        </el-header>
        <el-container>
            <el-aside :width="userStore.asideWidth">
                <f-menu></f-menu>
            </el-aside>
            <el-main>
                <f-tag-list/>
                <router-view v-slot="{ Component }">
                    <transition name="fade">
                        <keep-alive :max="10">
                            <component :is="Component"></component>
                        </keep-alive>
                    </transition>
                </router-view>
            </el-main>
        </el-container>
    </el-container>
</template>

<script setup>
import FHeader from './components/FHeader.vue';
import FMenu from './components/FMenu.vue';
import FTagList from './components/FTagList.vue';
import { useUserStore } from '~/store' // 导入 Pinia store

const userStore = useUserStore() // 使用 Pinia store
</script>

<style>
.el-aside {
    transition: all 0.2s;
}
.fade-enter-from {
    opacity: 0;
}
.fade-enter-to {
    opacity: 1;
}
.fade-leave-from {
    opacity: 1;
}
.fade-leave-to {
    opacity: 0;
}
.fade-enter-active,
.fade-leave-active {
    transition: all 0.3s;
}
.fade-enter-active {
    transition-delay: 0.3s;
}
</style>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\layouts\components\FHeader.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\layouts\components\FHeader.vue
```vue
<template>
  <div class="f-header">

      <!-- 这段代码会显示一个带图标的 Logo，图标和文字会根据应用的样式进行调整，例如增加右边距等。图标组件 <eleme-filled /> 显示一个“饿了么”风格的填充图标，文字 学习编程 显示应用的名称。 -->
      <span class="logo">
          <el-icon class="mr-1">
              <eleme-filled />
          </el-icon>
          学习编程
      </span>

      <!-- 这段代码实现了点击图标切换侧边栏宽度的功能，并根据宽度状态切换不同的图标： -->
      <el-icon class="icon-btn" @click="userStore.handleAsideWidth">
          <fold v-if="userStore.asideWidth === '250px'"/>
          <Expand v-else/>
      </el-icon>

      
      <!-- 这个代码创建了一个带有“刷新”功能的图标按钮，当用户将鼠标悬停在按钮上时，会显示提示文字“刷新”，并且按钮在被点击时会触发 handleRefresh 方法，通常用于刷新页面或数据。 -->
      <el-tooltip effect="dark" content="刷新" placement="bottom">
          <el-icon class="icon-btn" @click="handleRefresh">
              <refresh />
          </el-icon>
      </el-tooltip>


      <!-- 这个代码创建了一个带有“全屏”功能的图标按钮，当用户将鼠标悬停在按钮上时，会显示提示文字“全屏”，并且按钮在被点击时会触发 toggle 方法，通常用于全屏显示或退出全屏。 -->
      <div class="ml-auto flex items-center">
          <el-tooltip effect="dark" content="全屏" placement="bottom">
              <el-icon class="icon-btn" @click="toggle">
                  <full-screen v-if="!isFullscreen" />
                  <aim v-else />
              </el-icon>
          </el-tooltip>


          
          <!-- 这段代码实现了一个用户信息下拉菜单：
          显示用户头像和用户名。
          点击后展示三个操作项：更换头像、修改密码和退出登录。
          用户点击某一项时，会根据 command 值调用 handleCommand 方法来执行相应操作。 -->
          <el-dropdown class="dropdown" @command="handleCommand">
              <span class="flex items-center text-light-50">
                  <el-avatar class="mr-2" :size="25" :src="userStore.user.avatar" />
                  {{ userStore.user.username }}
                  <el-icon class="el-icon--right">
                      <arrow-down />
                  </el-icon>
              </span>
              <template #dropdown>
                  <el-dropdown-menu>
                      <el-dropdown-item command="updateAvatar">更换头像</el-dropdown-item>
                      <el-dropdown-item command="rePassword">修改密码</el-dropdown-item>
                      <el-dropdown-item command="logout">退出登录</el-dropdown-item>
                  </el-dropdown-menu>
              </template>
          </el-dropdown>
      </div>
  </div>

  <!-- 更换头像的表单抽屉 -->
  <form-drawer ref="avatarDrawerRef" title="更换头像" destroyOnClose @submit="onAvatarSubmit">
      <el-form ref="avatarFormRef" :model="avatarForm" label-width="80px" size="small">
          <el-form-item label="选择头像">
            <el-upload
              :file-list="avatarFileList"
              :auto-upload="false"
              :on-change="handleAvatarChange"
              list-type="picture-card"
              accept="image/*"
            >
              <i class="el-icon-plus"></i>
            </el-upload>

          </el-form-item>
      </el-form>
  </form-drawer>

  <!-- 修改密码的表单抽屉（保持不变） -->
  <form-drawer ref="formDrawerRef" title="修改密码" destroyOnClose @submit="onSubmit">
      <el-form ref="formRef" :rules="rules" :model="form" label-width="80px" size="small">
          <el-form-item prop="oldpassword" label="旧密码">
              <el-input v-model="form.oldpassword" placeholder="请输入旧密码"></el-input>
          </el-form-item>
          <el-form-item prop="password" label="新密码">
              <el-input type="password" v-model="form.password" placeholder="请输入新密码" show-password></el-input>
          </el-form-item>
          <el-form-item prop="repassword" label="确认密码">
              <el-input type="password" v-model="form.repassword" placeholder="请再次输入新密码" show-password></el-input>
          </el-form-item>
      </el-form>
  </form-drawer>

</template>

<script setup>
import FormDrawer from '~/components/FormDrawer.vue';
import { ref, reactive } from 'vue';
import { useFullscreen } from '@vueuse/core';
import { useRepassword, useLogout } from "~/composables/useManager";
import { useUserStore } from '~/store';
import { toast } from '~/composables/util';
import { uploadAvatar, updateUserInfo } from '~/api/user'; // 新增的 API 函数

const userStore = useUserStore();

const {
  isFullscreen,
  toggle
} = useFullscreen();

const {
  formDrawerRef,
  form,
  rules,
  formRef,
  onSubmit,
  openRePasswordForm
} = useRepassword();

const {
  handleLogout
} = useLogout();

// 处理用户下拉菜单的命令
const handleCommand = (command) => {
  switch (command) {
      case "updateAvatar":
          openAvatarDialog();
          break;
      case "rePassword":
          openRePasswordForm();
          break;
      case "logout":
          handleLogout();
          break;
  }
};

// 刷新页面
const handleRefresh = () => location.reload();

// 更换头像相关逻辑
const avatarDrawerRef = ref(null);
const avatarFormRef = ref(null);
const avatarForm = reactive({
  avatar: '',
});
const avatarFileList = ref([]);

const openAvatarDialog = () => {
  avatarDrawerRef.value.open();
};

const handleAvatarChange = (file, fileList) => {
  avatarFileList.value = fileList.slice(-1); // 只保留最新的文件
};


const onAvatarSubmit = async () => {
  if (avatarFileList.value.length === 0) {
    toast('请先选择一个头像图片', 'error');
    return;
  }

  avatarDrawerRef.value.showLoading();

  try {
    // 1. 上传头像图片
    const formData = new FormData();
    formData.append('avatar', avatarFileList.value[0].raw);

    const uploadRes = await uploadAvatar(formData);
    const avatarUrl = uploadRes.url;

    // 2. 更新用户头像
    await updateUserInfo({ avatar: avatarUrl });

    // 3. 更新用户状态
    userStore.user.avatar = avatarUrl;

    // 4. 关闭抽屉并重置表单
    avatarDrawerRef.value.close();
    avatarFileList.value = [];

    toast('头像更新成功');
  } catch (error) {
    // 错误处理
    toast('头像更新失败', 'error');
  } finally {
    avatarDrawerRef.value.hideLoading();
  }
};


</script>

<style>
.f-header {
  @apply flex items-center bg-indigo-700 text-light-50 fixed top-0 left-0 right-0;
  height: 64px;
  z-index: 1000;
}

.logo {
  width: 250px;
  @apply flex justify-center items-center text-xl font-thin;
}

.icon-btn {
  @apply flex justify-center items-center;
  width: 42px;
  height: 64px;
  cursor: pointer;
}

.icon-btn:hover {
  @apply bg-indigo-600;
}

.f-header .dropdown {
  height: 64px;
  cursor: pointer;
  @apply flex justify-center items-center mx-5;
}
</style>

```

====================== 课时50.店铺和交易提示组件开发和交互\src\layouts\components\FMenu.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\layouts\components\FMenu.vue
```vue
<template>
    <div class="f-menu" :style="{ width: userStore.asideWidth }">
        <el-menu :default-active="defaultActive" unique-opened :collapse="isCollapse" default-active="2" class="border-0" @select="handleSelect" :collapse-transition="false">

            <!-- 菜单 -->
             <!-- 遍历数组，:key 属性用于唯一标识数组中的每个元素，帮助 Vue 更高效地追踪和更新 DOM。 -->
            <template v-for="(item,index) in asideMenus" :key="index">
                <!-- 子菜单 -->
                <el-sub-menu v-if="item.child && item.child.length > 0" :index="item.name">
                    <!-- 子菜单标题，Vue 会将 <component :is="item.icon"></component> 渲染成指定的 icon 组件，比如 el-icon-home 或 el-icon-user 等，item.icon的属性是一个icon的值 -->
                    <template #title>
                        <el-icon>
                            <component :is="item.icon"></component>
                        </el-icon>
                        <span>{{ item.name }}</span>
                    </template>
                    
                    <!-- v-for 指令遍历并渲染 item.child 数组，生成多个 el-menu-item 子菜单项。 -->
                    <!-- key 是 Vue 的内部属性，用于唯一标识 v-for 循环中的每一个元素。
                    index 是 el-menu-item 组件的属性，并非 Vue 的内部属性。el-menu-item 的 index 属性用于为菜单项设置唯一的标识符，用来在菜单中追踪选中的项目。 -->
                    <el-menu-item v-for="(item2,index2) in item.child" :key="index2" :index="item2.frontpath">
                        <el-icon>
                            <component :is="item2.icon"></component>
                        </el-icon>
                        <span>{{ item2.name }}</span>
                    </el-menu-item>
                </el-sub-menu>

                <el-menu-item v-else :index="item.frontpath">
                    <el-icon>
                         <component :is="item.icon"></component>
                    </el-icon>
                    <span>{{ item.name }}</span>
                </el-menu-item>
            </template>
        </el-menu>
    </div>
</template>

<script setup>
import { computed, ref } from 'vue';
import { useRouter, useRoute } from 'vue-router';
import { useUserStore } from '~/store' // 导入 Pinia store

const router = useRouter()
const route = useRoute()
const userStore = useUserStore() // 使用 Pinia store

// 默认选中
const defaultActive = ref(route.path)

// 是否折叠
const isCollapse = computed(() => !(userStore.asideWidth === '250px'))

const asideMenus = computed(() => userStore.menus)

const handleSelect = (e) => {
    router.push(e)
}
</script>

<style>
.f-menu {
    transition: all 0.2s;
    top: 64px;
    bottom: 0;
    left: 0;
    overflow-y: auto;
    overflow-x: hidden;
    @apply shadow-md fixed bg-light-50;
}
.f-menu::-webkit-scrollbar {
    width: 0px;
}
</style>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\layouts\components\FTagList.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\layouts\components\FTagList.vue
```vue
<template>
    <div class="f-tag-list" :style="{ left: userStore.asideWidth }">
        <el-tabs
            v-model="activeTab"
            type="card"
            class="flex-1"
            @tab-remove="removeTab"
            style="min-width:100px;"
            @tab-change="changeTab"
        >
            <el-tab-pane
                v-for="item in tabList"
                :key="item.path"
                :label="item.title"
                :name="item.path"
                :closable="item.path !== '/'"
            ></el-tab-pane>
        </el-tabs>

        <span class="tag-btn">
            <el-dropdown @command="handleClose">
                <span class="el-dropdown-link">
                    <el-icon>
                        <arrow-down />
                    </el-icon>
                </span>
                <template #dropdown>
                    <el-dropdown-menu>
                        <el-dropdown-item command="clearOther">关闭其他</el-dropdown-item>
                        <el-dropdown-item command="clearAll">全部关闭</el-dropdown-item>
                    </el-dropdown-menu>
                </template>
            </el-dropdown>
        </span>
    </div>
    <div style="height:44px;"></div>
</template>

<script setup>
import { useTabList } from '~/composables/useTabList.js'
import { useUserStore } from '~/store' // 导入 Pinia 的 store

const userStore = useUserStore() // 获取 store 实例

const {
    activeTab,
    tabList,
    changeTab,
    removeTab,
    handleClose
} = useTabList()
</script>

<style scoped>
.f-tag-list{
    @apply fixed bg-gray-100 flex items-center px-2;
    top: 64px;
    right: 0;
    height: 44px;
    z-index: 100;
}
.tag-btn{
    @apply bg-white rounded ml-auto flex items-center justify-center px-2;
    height: 32px;
}
:deep(.el-tabs__header){
    border: 0!important;
    @apply mb-0;
}
:deep(.el-tabs__nav){
    border: 0!important;
}
:deep(.el-tabs__item){
    border: 0!important;
    height: 32px;
    line-height: 32px;
    @apply bg-white mx-1 rounded;
}
:deep(.el-tabs__nav-next),
:deep(.el-tabs__nav-prev){
    line-height: 32px;
    height: 32px;
}
:deep(.is-disabled){
    cursor: not-allowed;
    @apply text-gray-300;
}
</style>

```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\404.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\404.vue
```vue
<template>
    <div>
        <el-result
            icon="warning"
            title="404提示"
            sub-title="你找的页面走丢了~"
        >
            <template #extra>
                <el-button type="primary" @click="goToHome">回到首页</el-button>
            </template>
        </el-result>
    </div>
</template>

<script setup>
import { useRouter } from 'vue-router'

const router = useRouter()

const goToHome = () => {
    router.push('/')
}
</script>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\index.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\index.vue
```vue
<template>
    <div>
      <el-row :gutter="20">
        <!-- 骨架屏，数据加载前的占位 -->
        <template v-if="panels.length === 0">
          <el-col :span="6" v-for="i in 4" :key="i">
            <el-skeleton style="width: 100%;" animated loading>
              <template #template>
                <el-card shadow="hover" class="border-0">
                  <template #header>
                    <div class="flex justify-between">
                      <el-skeleton-item variant="text" style="width: 50%" />
                      <el-skeleton-item variant="text" style="width: 10%" />
                    </div>
                  </template>
                  <el-skeleton-item variant="h3" style="width: 80%" />
                  <el-divider />
                  <div class="flex justify-between text-sm text-gray-500">
                    <el-skeleton-item variant="text" style="width: 50%" />
                    <el-skeleton-item variant="text" style="width: 10%" />
                  </div>
                </el-card>
              </template>
            </el-skeleton>
          </el-col>
        </template>
  
        <!-- 数据展示部分 -->
        <el-col :span="6" v-for="(item, index) in panels" :key="index">
          <el-card shadow="hover" class="border-0">
            <template #header>
              <div class="flex justify-between">
                <span class="text-sm">{{ item.title }}</span>
                <el-tag :type="item.unitColor" effect="plain">
                  {{ item.unit }}
                </el-tag>
              </div>
            </template>
            <span class="text-3xl font-bold text-gray-500">
              <CountTo :value="item.value" />
            </span>
            <el-divider />
            <div class="flex justify-between text-sm text-gray-500">
              <span>{{ item.subTitle }}</span>
              <span>{{ item.subValue }}</span>
            </div>
          </el-card>
        </el-col>
      </el-row>
  
      <!-- 其他组件 -->
      <IndexNavs />
  
      <el-row :gutter="20" class="mt-5">
        <el-col :span="12">
          <IndexChart />
        </el-col>
        <el-col :span="12">
          <IndexCard title="店铺及商品提示" tip="店铺及商品提示" :btns="goods" class="mb-3" />
          <IndexCard title="交易提示" tip="需要立即处理的交易订单" :btns="order" />
        </el-col>
      </el-row>
    </div>
  </template>
  
  <script setup>
  import { ref } from 'vue';
  import CountTo from '~/components/CountTo.vue';
  import IndexNavs from '~/components/IndexNavs.vue';
  import IndexChart from '~/components/IndexChart.vue';
  import IndexCard from '~/components/IndexCard.vue';
  import { getStatistics1, getStatistics2 } from '~/api/index.js';
  
  const panels = ref([]);
  const goods = ref([]);
  const order = ref([]);
  
  // 定义有效的 ElTag 类型
  const validTagTypes = ['primary', 'success', 'info', 'warning', 'danger'];
  
  // 获取统计数据并预处理
  getStatistics1().then((res) => {
    panels.value = res.panels.map((panel) => {
      // 确保 unitColor 有效
      if (!validTagTypes.includes(panel.unitColor)) {
        panel.unitColor = 'info'; // 设置默认值
      }
      return panel;
    });
  });
  
  // 获取商品和订单提示数据
  getStatistics2().then((res) => {
    goods.value = res.goods;
    order.value = res.order;
  });
  </script>
  
  <style scoped>
  /* 添加必要的样式 */
  </style>
  
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\login.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\login.vue
```vue
<script setup>
import { ref, reactive, onMounted, onBeforeUnmount } from 'vue'
import { useRouter } from 'vue-router'
import { useUserStore } from '~/store'
import { toast } from '~/composables/util'

const router = useRouter()
const userStore = useUserStore()

const form = reactive({
  username: '',
  password: ''
})

const rules = {
  username: [
    { required: true, message: '用户名不能为空', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '密码不能为空', trigger: 'blur' }
  ]
}

const formRef = ref(null)
const loading = ref(false)

const onSubmit = () => {
  formRef.value.validate(async (valid) => {
    if (!valid) return false
    loading.value = true
    try {
      await userStore.loginUser(form)
      toast('登录成功')
      router.push('/')
    } catch (err) {
      console.error(err)
    } finally {
      loading.value = false
    }
  })
}

function onKeyUp(e) {
  if (e.key === 'Enter') onSubmit()
}

onMounted(() => {
  document.addEventListener('keyup', onKeyUp)
})

onBeforeUnmount(() => {
  document.removeEventListener('keyup', onKeyUp)
})
</script>

<template>
  <div class="login-container">
    <el-card class="login-card">
      <h2 class="title">欢迎回来</h2>
      <div class="divider">
        <span class="line"></span>
        <span>账号密码登录</span>
        <span class="line"></span>
      </div>
      <el-form ref="formRef" :rules="rules" :model="form" class="form-container">
        <el-form-item prop="username">
          <el-input v-model="form.username" placeholder="请输入用户名">
            <template #prefix>
              <el-icon><user /></el-icon>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item prop="password">
          <el-input type="password" v-model="form.password" placeholder="请输入密码" show-password>
            <template #prefix>
              <el-icon><lock /></el-icon>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item>
          <el-button round color="#626aef" class="w-full" type="primary" @click="onSubmit" :loading="loading">登 录</el-button>
        </el-form-item>
      </el-form>
    </el-card>
  </div>
</template>

<style scoped>
.login-container {
  @apply min-h-screen bg-indigo-500 flex items-center justify-center;
}

.login-card {
  @apply w-[400px] p-8 bg-white shadow-lg rounded-lg;
}

.title {
  @apply font-bold text-3xl text-gray-800 text-center mb-6;
}

.divider {
  @apply flex items-center justify-center my-5 text-gray-300 space-x-2;
}

.line {
  @apply h-[1px] w-16 bg-gray-200;
}

.form-container {
  @apply flex flex-col items-center;
}

.el-form-item {
  @apply w-full;
}

.el-button {
  @apply w-full;
}
</style>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\category\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\category\list.vue
```vue
<template>
    <div>
        分类列表
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\comment\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\comment\list.vue
```vue
<template>
    <div>
       评价列表
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\coupon\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\coupon\list.vue
```vue
<template>
    <div>
      优惠券列表
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\goods\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\goods\list.vue
```vue
<template>
    <div>
        商品管理
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\image\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\image\list.vue
```vue
<template>
    <div>
      图库列表
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\notice\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\notice\list.vue
```vue
<template>
    <div>
      公告列表
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\order\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\order\list.vue
```vue
<template>
    <div>
       订单列表
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\setting\base.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\setting\base.vue
```vue
<template>
    <div>
      配置
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\pages\user\list.vue ======================
## 课时50.店铺和交易提示组件开发和交互\src\pages\user\list.vue
```vue
<template>
    <div>
        用户列表
    </div>
</template>
```

====================== 课时50.店铺和交易提示组件开发和交互\src\router\index.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\router\index.js
```js
import {
    createRouter,
    createWebHashHistory
} from 'vue-router'

import Admin from "~/layouts/admin.vue";
import Index from '~/pages/index.vue'
import Login from '~/pages/login.vue'
import NotFound from '~/pages/404.vue'
import GoodList from '~/pages/goods/list.vue'
import CategoryList from '~/pages/category/list.vue'
import UserList from '~/pages/user/list.vue'
import OrderList from '~/pages/order/list.vue'
import CommentList from '~/pages/comment/list.vue'
import ImageList from '~/pages/image/list.vue'
import NoticeList from '~/pages/notice/list.vue'
import SettingBase from '~/pages/setting/base.vue'
import CouponList from '~/pages/coupon/list.vue'


// 默认路由，所有用户共享
const routes = [
    {
        path: "/",
        name:"admin",
        component: Admin,
    },
    {
        path: "/login",
        component: Login,
        meta: {
            title: "登录页"
        }
    }, {
        path: '/:pathMatch(.*)*',
        name: 'NotFound',
        component: NotFound
    }]


// 动态路由，用于匹配菜单动态添加路由
const asyncRoutes = [{
    path:"/",
    name:"/",
    component:Index,
    meta:{
        title:"后台首页"
    }
},{
    path:"/goods/list",
    name:"/goods/list",
    component:GoodList,
    meta:{
        title:"商品管理"
    }
},{
    path:"/category/list",
    name:"/category/list",
    component:CategoryList,
    meta:{
        title:"分类列表"
    }
},{
    path:"/user/list",
    name:"/user/list",
    component:UserList,
    meta:{
        title:"用户列表"
    }
},{
    path:"/order/list",
    name:"/order/list",
    component:OrderList,
    meta:{
        title:"订单列表"
    }
},{
    path:"/comment/list",
    name:"/comment/list",
    component:CommentList,
    meta:{
        title:"评价列表"
    }
},{
    path:"/image/list",
    name:"/image/list",
    component:ImageList,
    meta:{
        title:"图库列表"
    }
},{
    path:"/notice/list",
    name:"/notice/list",
    component:NoticeList,
    meta:{
        title:"公告列表"
    }
},{
    path:"/setting/base",
    name:"/setting/base",
    component:SettingBase,
    meta:{
        title:"配置"
    }
},{
    path:"/coupon/list",
    name:"/coupon/list",
    component:CouponList,
    meta:{
        title:"优惠券列表"
    }
}]


// 定义静态路由
export const router = createRouter({
    history: createWebHashHistory(),
    routes
})



// 定义动态路由
// 动态添加路由的方法
// 这个代码的作用是根据后端返回的用户菜单权限动态添加路由。具体来说，它遍历后端返回的菜单权限数组，找到与前端定义的动态路由匹配的项，并将这些路由动态添加到 Vue Router 中。
// 动态添加路由的函数
//这个会把所有的后端传过来的路由变成admin的子路由
// 这个只是返回是否有新的路由被添加了，不会改变路由结构，也不会改变菜单结构
export function addRoutes(menus) {
    // 是否有新的路由被添加的标志，这个标志用于判断是否需要重新加载页面
    // 如果有新的路由被添加，则返回 true，否则返回 false。
    // 如果有新的路由被添加，则需要重新加载页面，否则不需要重新加载页面。
    let hasNewRoutes = false;

    // 定义一个递归函数来查找并添加路由
    const findAndAddRoutesByMenus = (arr) => {
        // 遍历传入的菜单数组，arr.forEach 是 JavaScript 数组的一个内置方法，用于遍历数组中的每个元素，并对每个元素执行指定的回调函数。
        arr.forEach((menuItem) => {
            // 在 asyncRoutes 中查找与当前菜单项 frontpath 匹配的路由，route.path是动态路由定义好的属性和menuItem.frontpath是后端返回的菜单项的frontpath属性的。
            // 如果找到匹配的路由，则将其添加到名为 "admin" 的路由中。
            let matchedRoute = asyncRoutes.find((route) => route.path === menuItem.frontpath);

            // 如果找到匹配的路由且该路由尚未添加到 router 中
            if (matchedRoute && !router.hasRoute(matchedRoute.path)) {
                // 将该路由添加到名为 "admin" 的路由中
                router.addRoute("admin", matchedRoute);
                // 标记有新的路由被添加
                hasNewRoutes = true;
            }

            // 如果当前菜单项有子菜单，递归处理子菜单，这个里面的当前菜单项是后端返回的菜单项，不是前端定义的动态路由。
            if (menuItem.child && menuItem.child.length > 0) {
                findAndAddRoutesByMenus(menuItem.child);
            }
        });
    };

    // 从 menus 开始递归查找并添加路由
    findAndAddRoutesByMenus(menus);

    // 返回是否有新的路由被添加
    return hasNewRoutes;
}
```

====================== 课时50.店铺和交易提示组件开发和交互\src\store\index.js ======================
## 课时50.店铺和交易提示组件开发和交互\src\store\index.js
```js
import { defineStore } from 'pinia'
import { ref } from 'vue'
import { login, getinfo } from '~/api/manager'
import { setToken, removeToken } from '~/composables/auth'

export const useUserStore = defineStore('user', () => {
    // 用户信息
    const user = ref({})

    // 侧边宽度
    const asideWidth = ref('250px')

    // 菜单
    const menus = ref([])

    // 规则名称
    const ruleNames = ref([])

    // 记录用户信息
    function setUserInfo(userInfo) {
        user.value = userInfo
    }

    // 展开/缩起侧边
    function handleAsideWidth() {
        asideWidth.value = asideWidth.value === '250px' ? '64px' : '250px'
    }

    // 设置菜单
    function setMenus(menusList) {
        menus.value = menusList   // 用于将传入的 menusList 参数赋值给 menus 状态。
    }

    // 设置规则名称
    function setRuleNames(ruleNamesList) {
        ruleNames.value = ruleNamesList
    }

    // 登录
    async function loginUser({ username, password }) {
        try {
            const res = await login(username, password)
            setToken(res.token)
            return res
        } catch (err) {
            throw err
        }
    }

    // 获取当前登录用户信息
    async function fetchUserInfo() {
        try {
            const res = await getinfo()
            setUserInfo(res)
            setMenus(res.menus)
            setRuleNames(res.ruleNames)
            return res
        } catch (err) {
            throw err
        }
    }

    // 退出登录
    function logoutUser() {
        // 移除cookie里的token
        removeToken()
        // 清除当前用户状态
        setUserInfo({})
    }

    return {
        user,
        asideWidth,
        menus,
        ruleNames,
        setUserInfo,
        handleAsideWidth,
        setMenus,
        setRuleNames,
        loginUser,
        fetchUserInfo,
        logoutUser
    }
})
```

